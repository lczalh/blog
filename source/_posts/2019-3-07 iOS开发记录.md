---
layout: post
title: "iOS 记录"
date: 2019-03-07 14:43:45
tags: iOS
---

记录点常用方法、属性以及遇到的问题

## 1. GCD信号量
```
//创建信号量
dispatch_semaphore_t semaphore = dispatch_semaphore_create(1);
dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
dispatch_async(queue, ^{
    // 等待信号量
    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);
    // 发起网络请求
    [BadgeCountModel HomeBadgeCountBlock:^(NSDictionary *data) {
        NSNumber *num = data[@"num"];
        if (num.integerValue > 0 ) {
            weakSelf.rightBt.isShowBadge = YES;
        } else {
            weakSelf.rightBt.isShowBadge = NO;
        }
        // 发送信号量
        dispatch_semaphore_signal(semaphore);
    } andError:^(NSError *error) {
        dispatch_semaphore_signal(semaphore);
    }]; 
});

dispatch_async(queue, ^{
    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);
    // 发起网络请求
    [BadgeCountModel HomeDetailBadgeCountBlock:^(NSArray *data) {
        if (!weakSelf.badgeDict) {
            weakSelf.badgeDict = [NSMutableDictionary dictionary];
        }
        [weakSelf.badgeDict removeAllObjects];
        NSMutableArray *badgeArray = [NSMutableArray array];
        for (NSDictionary *dict in data) {
            BadgeCountModel *model = [[BadgeCountModel alloc] init];
            model.code = [NSString stringWithFormat:@"%@",dict[@"key"]];
            model.value = [NSString stringWithFormat:@"%@",dict[@"value"]];
            [badgeArray addObject:model];
            NSIndexPath *path = [self getIndexPathWithCode:model.code];
            if (!path) {
                continue;
            }
            [weakSelf.badgeDict setObject:model.value forKey:path];
        }
        [weakSelf.collectionView reloadData];
        [[GLMenuManager shareInstance] setRedPointArray:badgeArray];
        dispatch_semaphore_signal(semaphore);
    } andError:^(NSError *error) {
        dispatch_semaphore_signal(semaphore);
    }];
});
```

## 2. 隐藏UITabBarController上的按钮
```
// 方法
- (void)hideContentController:(UIViewController*)content{
    [content willMoveToParentViewController:nil];// 1
    [content.view removeFromSuperview];// 2
    [content removeFromParentViewController];// 3
}

// 调用
[self hideContentController:self.tabBarController.viewControllers[0]];
```

## 3. 在子视图中获取父控制器、父视图
#### Objective-C
```
/**
获取父控制器

@param view 当前视图
@param className 需要获取的控制器名称
@return 返回控制器对象
*/
- (UIViewController *)LCZGetSuperViewController:(UIView *)currentview superViewControllerClassName:(NSString *)className
{
    for (UIView* next = [current superview]; next; next = next.superview) {
    UIResponder *nextResponder = [next nextResponder];
        if ([nextResponder isKindOfClass:[NSClassFromString(className) class]]) {
            return (UIViewController *)nextResponder;
        }
    }
    return nil;
}

/**
获取当前视图中的目标父视图

@param currentView 当前视图
@param superView 父视图
@return 父视图对象
*/
- (UIView *)LCZGetSuperView:(UIView *)currentView superView:(UIView *)superView {
    UIView *view = currentView.superview;
    while (![view isKindOfClass:[superView class]]) {
        if (view.superview == nil) {
            return nil;
        } else {
        view = [view superview];
        }
    }
    return view;
}
```

#### Swift
```
/// 通过当前视图获取父视图的控制器
///
/// - Parameters:
///   - currentView: 当前视图
///   - viewController: 需要获取到的控制器
/// - Returns: 返回控制器
func LCZGetSuperViewController<T: UIViewController>(currentView:UIView, viewController: T.Type) -> T? {
    var view: UIView = currentView.superview!
    while view.next!.isKind(of: T.self) != true {
        guard view.superview != nil else {
            return nil
        }
        view = view.superview!
    }
    return view.next as? T
}

/// 获取当前视图中的目标父视图
///
/// - Parameters:
///   - currentView: 当前视图
///   - superView: 目标父视图
/// - Returns: 返回父视图
public func LCZGetSuperView<T: UIView>(currentView: UIView, superView: T.Type) -> T? {
    var view: UIView = currentView.superview!
    while view.isKind(of: T.self) != true {
        guard view.superview != nil else {
            return nil
        }
        view = view.superview!
        }
    return view as? T
}
```

## 4. Masonry优先完全显示内容、抵抗压缩
```
// 优先完全显示内容
[self.titleLabel setContentHuggingPriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisHorizontal];
// 抵抗压缩
[self.titleLabel setContentCompressionResistancePriority:UILayoutPriorityRequired forAxis:UILayoutConstraintAxisHorizontal];
```

## 5. SnapKit优先完全显示内容、抵抗压缩
```
self.title.setContentHuggingPriority(.required, for: .horizontal)
self.title.setContentCompressionResistancePriority(.required, for: .horizontal)
```

## 6. UITableView自适应高度
```
self.homeTableView.estimatedRowHeight = 44
self.homeTableView.rowHeight = UITableViewAutomaticDimension;
```

## 7. GCD单例
```
+ (instancetype)shared {
    static Share *shared = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        shared = [[Share alloc]init];
    });
    return shared;
}
```


